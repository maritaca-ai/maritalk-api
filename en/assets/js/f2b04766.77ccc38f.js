"use strict";(self.webpackChunkmaritaca=self.webpackChunkmaritaca||[]).push([[1550],{2829:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var n=a(4848),s=a(8453);const i={id:"batch-api",title:"Batch API"},t="O que \xe9?",r={id:"pt/batch-api",title:"Batch API",description:"A Batch API \xe9 uma op\xe7\xe3o eficiente para enviar grupos de solicita\xe7\xf5es ass\xedncronas, oferecendo redu\xe7\xe3o de custos de at\xe9 50%. Nessa modalidade, os limites de taxa s\xe3o calculados com base em caracteres por dia, embora a cobran\xe7a continue sendo feita por tokens. Para os tiers 1, 2, 3, 4 e 5, o limite di\xe1rio \xe9 de 1,2 bilh\xf5es de caracteres (aproximadamente 300M de tokens), enquanto para o tier 0 o limite \xe9 de 4 milh\xf5es de caracteres (aproximadamente 1M de tokens) por dia. Apenas os tokens de entrada s\xe3o contabilizados para fins de rate limit.",source:"@site/docs/pt/batch_api.md",sourceDirName:"pt",slug:"/pt/batch-api",permalink:"/en/pt/batch-api",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"batch-api",title:"Batch API"},sidebar:"sidebarPt",previous:{title:"Rate Limits",permalink:"/en/pt/rate-limits"},next:{title:"Biblioteca",permalink:"/en/pt/biblioteca"}},d={},l=[{value:"Interface visual",id:"interface-visual",level:2},{value:"Uso via c\xf3digo",id:"uso-via-c\xf3digo",level:2},{value:"1. Preparando seu arquivo de lote",id:"1-preparando-seu-arquivo-de-lote",level:3},{value:"2. Enviando o arquivo de entrada para o lote",id:"2-enviando-o-arquivo-de-entrada-para-o-lote",level:3},{value:"3. Criando o lote",id:"3-criando-o-lote",level:3},{value:"4. Verificando o status do lote",id:"4-verificando-o-status-do-lote",level:3},{value:"Status do batch",id:"status-do-batch",level:4},{value:"5. Obtendo os resultados do lote",id:"5-obtendo-os-resultados-do-lote",level:3},{value:"Manipulando o Arquivo JSONL",id:"manipulando-o-arquivo-jsonl",level:4},{value:"6. Cancelando um Lote",id:"6-cancelando-um-lote",level:3},{value:"7.  Listando Todos os Lotes",id:"7--listando-todos-os-lotes",level:3},{value:"Entendendo a expira\xe7\xe3o de lotes",id:"entendendo-a-expira\xe7\xe3o-de-lotes",level:4}];function c(e){const o={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"o-que-\xe9",children:"O que \xe9?"})}),"\n",(0,n.jsx)(o.p,{children:"A Batch API \xe9 uma op\xe7\xe3o eficiente para enviar grupos de solicita\xe7\xf5es ass\xedncronas, oferecendo redu\xe7\xe3o de custos de at\xe9 50%. Nessa modalidade, os limites de taxa s\xe3o calculados com base em caracteres por dia, embora a cobran\xe7a continue sendo feita por tokens. Para os tiers 1, 2, 3, 4 e 5, o limite di\xe1rio \xe9 de 1,2 bilh\xf5es de caracteres (aproximadamente 300M de tokens), enquanto para o tier 0 o limite \xe9 de 4 milh\xf5es de caracteres (aproximadamente 1M de tokens) por dia. Apenas os tokens de entrada s\xe3o contabilizados para fins de rate limit."}),"\n",(0,n.jsx)(o.p,{children:"Al\xe9m disso, h\xe1 um prazo de at\xe9 24 horas para a conclus\xe3o das requisi\xe7\xf5es, o que torna o servi\xe7o especialmente indicado para processos que n\xe3o exigem respostas imediatas e para reduzir os custos operacionais. Como as requisi\xe7\xf5es podem levar at\xe9 24 horas para serem processadas e os lotes expiram se n\xe3o forem conclu\xeddos dentro desse prazo, a Batch API n\xe3o \xe9 indicada para cen\xe1rios cr\xedticos, nos quais h\xe1 risco de falha na execu\xe7\xe3o devido \xe0 expira\xe7\xe3o."}),"\n",(0,n.jsx)(o.p,{children:"O processamento em lote costuma ser \xfatil em casos como:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Tradu\xe7\xe3o ou verifica\xe7\xe3o de texto em massa"}),"\n",(0,n.jsx)(o.li,{children:"Execu\xe7\xe3o de avalia\xe7\xf5es"}),"\n",(0,n.jsx)(o.li,{children:"Classifica\xe7\xe3o de grandes conjuntos de dados"}),"\n",(0,n.jsx)(o.li,{children:"Resumo de m\xfaltiplos documentos"}),"\n",(0,n.jsx)(o.li,{children:"Extra\xe7\xe3o de entidades e palavras-chave em documentos"}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"A Batch API \xe9 composta por um conjunto de endpoints que permitem:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Criar um novo lote (POST /batches): Inicia o processamento em lote enviando um conjunto de solicita\xe7\xf5es de uma s\xf3 vez."}),"\n",(0,n.jsx)(o.li,{children:"Consultar status do lote (GET /batches/{id}/status): Retorna o andamento do processamento, informando se ainda est\xe1 em execu\xe7\xe3o ou se j\xe1 foi finalizado."}),"\n",(0,n.jsx)(o.li,{children:"Recuperar resultados (GET /batches/{id}/results): Fornece as respostas de cada solicita\xe7\xe3o do lote assim que o processamento \xe9 conclu\xeddo."}),"\n"]}),"\n",(0,n.jsx)(o.h1,{id:"como-usar",children:"Como usar"}),"\n",(0,n.jsx)(o.p,{children:"Voc\xea pode trabalhar com a Batch API de duas maneiras: pela interface visual ou programaticamente, via c\xf3digo."}),"\n",(0,n.jsx)(o.h2,{id:"interface-visual",children:"Interface visual"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Na interface web, o fluxo para enviar seu arquivo .jsonl come\xe7a pelo menu lateral: selecione a op\xe7\xe3o Arquivos; em seguida, no canto superior-direito da tela, clique no bot\xe3o + Upload. Ser\xe1 exibida uma janela modal onde voc\xea deve arrastar ou escolher o arquivo a partir do seu computador \u2014 basta soltar o .jsonl na \xe1rea tracejada que aparece no centro do di\xe1logo. Depois de selecionar o arquivo, pressione Upload para iniciar o envio. Quando o upload terminar, o documento aparecer\xe1 na lista de arquivos com o status processed e receber\xe1 um file_id; \xe9 esse identificador que voc\xea utilizar\xe1 para criar o batch na etapa seguinte. Cada arquivo pode ter no m\xe1ximo 200MB e at\xe9 50k requisi\xe7\xf5es."}),"\n"]}),"\n",(0,n.jsx)("img",{src:"/img/Batch0.png",alt:"Sabia",style:{width:"100rem",height:"auto",marginRight:"15px"}}),"\n",(0,n.jsxs)(o.ol,{start:"2",children:["\n",(0,n.jsx)(o.li,{children:"Para criar o lote na interface web, abra o menu lateral e selecione Batch API; a listagem de lotes \xe9 exibida no painel principal. No canto superior-direito clique em + Criar para abrir o di\xe1logo Criar Batch. Nesse modal basta colar o File ID gerado na etapa anterior (o arquivo deve ter at\xe9 200 MB ou 50 mil requisi\xe7\xf5es) e, em seguida, pressionar Criar Batch. O sistema passa a validar o arquivo e, assim que a execu\xe7\xe3o se inicia, o novo lote aparece na lista com o respectivo identificador e o progresso em tempo real."}),"\n"]}),"\n",(0,n.jsx)("img",{src:"/img/Batch1.png",alt:"Sabia",style:{width:"100rem",height:"auto",marginRight:"15px"}}),"\n",(0,n.jsx)(o.h2,{id:"uso-via-c\xf3digo",children:"Uso via c\xf3digo"}),"\n",(0,n.jsx)(o.h3,{id:"1-preparando-seu-arquivo-de-lote",children:"1. Preparando seu arquivo de lote"}),"\n",(0,n.jsxs)(o.p,{children:["Para cada lote use um \xfanico arquivo .jsonl: cada linha corresponde a uma solicita\xe7\xe3o da API (mesmos par\xe2metros do endpoint). Inclua em cada requisi\xe7\xe3o um custom_id exclusivo para localizar o resultado depois. Cada arquivo pode ter no m\xe1ximo 200MB e at\xe9 50k requisi\xe7\xf5es. Exemplo (duas solicita\xe7\xf5es):\n",(0,n.jsx)(o.em,{children:"Observa\xe7\xe3o"}),": cada arquivo s\xf3 pode conter solicita\xe7\xf5es para um \xfanico modelo."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'{"custom_id": "request-1", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "sabia-3", "messages": [{"role": "system", "content": "Voc\xea \xe9 um assistente \xfatil"},{"role": "user", "content": "Ol\xe1 mundo!"}],"max_tokens": 100}}\n{"custom_id": "request-2", "method": "POST", "url": "/v1/chat/completions","body": {"model": "sabia-3", "messages": [{"role": "system", "content": "Voc\xea \xe9 um assistente \xfatil"},{"role": "user", "content": "Ol\xe1 mundo!"}],"max_tokens": 100}}\n'})}),"\n",(0,n.jsx)(o.h3,{id:"2-enviando-o-arquivo-de-entrada-para-o-lote",children:"2. Enviando o arquivo de entrada para o lote"}),"\n",(0,n.jsx)(o.p,{children:"Envie seu arquivo .jsonl usando o endpoint abaixo. Os arquivos podem conter no m\xe1ximo 50.000 requisi\xe7\xf5es e n\xe3o devem ultrapassar 200MB cada."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\n\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\n\n\nbatch_input_file = client.files.create(\n    file=open("batchinput.jsonl", "rb"),\n    purpose="batch"\n)\n\nprint(batch_input_file)\n\n'})}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Observa\xe7\xe3o:"}),' Atualmente, somente \xe9 suportado o prop\xf3sito "batch" para upload de arquivos. Os outros prop\xf3sitos (como "finetuning" e "assistant") n\xe3o s\xe3o suportados.']}),"\n",(0,n.jsx)(o.h3,{id:"3-criando-o-lote",children:"3. Criando o lote"}),"\n",(0,n.jsx)(o.p,{children:"Use o ID do arquivo (por exemplo, file1) para criar o lote. O completion_window \xe9 fixo em 24h, e voc\xea pode fornecer metadados extras por meio do par\xe2metro metadata. Exemplo:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\n\nbatch_input_file_id = batch_input_file.id\nclient.batches.create(\n    input_file_id=batch_input_file_id,\n    endpoint="/v1/chat/completions",\n    completion_window="24h",\n    metadata={\n        "description": "job for marketing data",\n        "owner": "marketing team"\n    }\n)\n'})}),"\n",(0,n.jsx)(o.p,{children:"Essa requisi\xe7\xe3o retornar\xe1 um objeto Batch com as informa\xe7\xf5es sobre o lote:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'{\n  "id": "batch1",\n  "object": "batch",\n  "endpoint": "/v1/chat/completions",\n  "errors": null,\n  "input_file_id": "file1",\n  "completion_window": "24h",\n  "status": "validating",\n  "output_file_id": null,\n  "error_file_id": null,\n  "created_at": 1744838747,\n  "in_progress_at": null,\n  "expires_at": 1744838747,\n  "completed_at": null,\n  "failed_at": null,\n  "expired_at": null,\n  "request_counts": {\n    "total": 0,\n    "completed": 0,\n    "failed": 0\n  },\n  "metadata": null\n}\n'})}),"\n",(0,n.jsx)(o.h3,{id:"4-verificando-o-status-do-lote",children:"4. Verificando o status do lote"}),"\n",(0,n.jsx)(o.p,{children:"\xc9 poss\xedvel consultar o status de um lote a qualquer momento, recebendo tamb\xe9m o objeto Batch correspondente no processo:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\nfrom openai import OpenAI\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\n\nbatch = client.batches.retrieve("batch1")\nprint(batch)\n'})}),"\n",(0,n.jsx)(o.h4,{id:"status-do-batch",children:"Status do batch"}),"\n",(0,n.jsx)(o.p,{children:"Cada objeto Batch pode ter um dos seguintes status:"}),"\n",(0,n.jsxs)(o.table,{children:[(0,n.jsx)(o.thead,{children:(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.th,{children:(0,n.jsx)(o.strong,{children:"Status"})}),(0,n.jsx)(o.th,{children:(0,n.jsx)(o.strong,{children:"Descri\xe7\xe3o"})})]})}),(0,n.jsxs)(o.tbody,{children:[(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"validating"}),(0,n.jsx)(o.td,{children:"o arquivo de entrada est\xe1 sendo validado antes de o lote iniciar"})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"failed"}),(0,n.jsx)(o.td,{children:"A valida\xe7\xe3o do arquivo de entrada n\xe3o obteve sucesso."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"in_progress"}),(0,n.jsx)(o.td,{children:"O arquivo de entrada foi validado com sucesso e o lote est\xe1 em execu\xe7\xe3o."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"finalizing"}),(0,n.jsx)(o.td,{children:"O lote foi conclu\xeddo e os resultados est\xe3o sendo preparados."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"completed"}),(0,n.jsx)(o.td,{children:"O lote foi conclu\xeddo e os resultados est\xe3o prontos."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"expired"}),(0,n.jsx)(o.td,{children:"O lote n\xe3o foi conclu\xeddo dentro da janela de 24 horas e expirou."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"cancelling"}),(0,n.jsx)(o.td,{children:"O lote est\xe1 sendo cancelado, podendo levar at\xe9 10 minutos para finalizar."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:"cancelled"}),(0,n.jsx)(o.td,{children:"O lote foi cancelado e n\xe3o continuar\xe1 sendo processado."})]})]})]}),"\n",(0,n.jsx)(o.h3,{id:"5-obtendo-os-resultados-do-lote",children:"5. Obtendo os resultados do lote"}),"\n",(0,n.jsx)(o.p,{children:"Quando o lote tiver sido processado, voc\xea pode obter o arquivo de sa\xedda enviando uma requisi\xe7\xe3o para a API utilizando o output_file_id do objeto Batch. Depois de receber o arquivo, salve-o localmente (por exemplo, como batch_output.jsonl)."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\nfile_response = client.files.content("file1")\nprint(file_response.text)\n'})}),"\n",(0,n.jsx)(o.h4,{id:"manipulando-o-arquivo-jsonl",children:"Manipulando o Arquivo JSONL"}),"\n",(0,n.jsx)(o.p,{children:"O arquivo de sa\xedda JSONL conter\xe1 uma linha de resposta para cada requisi\xe7\xe3o bem-sucedida do seu arquivo de entrada. Quaisquer requisi\xe7\xf5es com falha ter\xe3o seus detalhes de erro registrados em um arquivo de erro separado, cujo ID pode ser encontrado em error_file_id no objeto Batch."}),"\n",(0,n.jsx)(o.p,{children:"Observe que a ordem das linhas de sa\xedda pode n\xe3o corresponder \xe0 ordem das linhas de entrada. Para correlacionar cada sa\xedda com sua requisi\xe7\xe3o de entrada, utilize o campo custom_id, presente em cada linha do arquivo de sa\xedda."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-jsonl",children:'{"id": "batch_req_1", "custom_id": "request1", "response": {"status_code": 200, "request_id": "req_1", "body": {"id": "chat1", "object": "chat.completion", "created": 1744838747, "model": "sabia-3", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Ol\xe1 mundo."}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5, "completion_tokens": 14, "total_tokens": 19}, "system_fingerprint": "abc123"}}, "error": null}\n{"id": "batch_req_1", "custom_id": "request2", "response": {"status_code": 200, "request_id": "req_2", "body": {"id": "chat2", "object": "chat.completion", "created": 1744838747, "model": "sabia-3", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Hello World."}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4, "completion_tokens": 26, "total_tokens": 30}, "system_fingerprint": "abc123"}}, "error": null}\n'})}),"\n",(0,n.jsx)(o.p,{children:"Ap\xf3s a conclus\xe3o do lote, o arquivo de sa\xedda permanece dispon\xedvel por 30 dias e \xe9 exclu\xeddo automaticamente depois disso."}),"\n",(0,n.jsx)(o.h3,{id:"6-cancelando-um-lote",children:"6. Cancelando um Lote"}),"\n",(0,n.jsx)(o.p,{children:"Se necess\xe1rio, \xe9 poss\xedvel cancelar um lote que esteja em execu\xe7\xe3o. Durante o cancelamento, o status do lote muda para canceling enquanto as requisi\xe7\xf5es em andamento continuam (podendo levar at\xe9 10 minutos). Assim que essas requisi\xe7\xf5es forem finalizadas, o status muda para cancelled."}),"\n",(0,n.jsx)(o.p,{children:"Cancelando um lote:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\n\nclient.batches.cancel("batch1")\n'})}),"\n",(0,n.jsx)(o.h3,{id:"7--listando-todos-os-lotes",children:"7.  Listando Todos os Lotes"}),"\n",(0,n.jsx)(o.p,{children:"Voc\xea pode visualizar todos os seus lotes a qualquer momento. Se possuir muitos lotes, utilize os par\xe2metros limit e after para paginar os resultados."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-python",children:'from openai import OpenAI\nclient = openai.OpenAI(\n    api_key="", #Sua API_KEY\n    base_url="https://chat.maritaca.ai/api",\n)\n\nclient.batches.list(limit=10)\n'})}),"\n",(0,n.jsx)(o.h4,{id:"entendendo-a-expira\xe7\xe3o-de-lotes",children:"Entendendo a expira\xe7\xe3o de lotes"}),"\n",(0,n.jsx)(o.p,{children:"Se um lote n\xe3o for conclu\xeddo dentro do tempo previsto, ele passar\xe1 para o estado expired. Quaisquer requisi\xe7\xf5es incompletas ser\xe3o canceladas, enquanto as requisi\xe7\xf5es conclu\xeddas continuam dispon\xedveis por meio do arquivo de sa\xedda do lote. Voc\xea ainda ser\xe1 cobrado pelos tokens consumidos nas requisi\xe7\xf5es que foram conclu\xeddas com sucesso."}),"\n",(0,n.jsx)(o.p,{children:"As requisi\xe7\xf5es que expirarem ser\xe3o adicionadas ao seu arquivo de erro com uma mensagem semelhante \xe0 exibida abaixo. Voc\xea pode usar o custom_id para recuperar detalhes das requisi\xe7\xf5es que expiraram."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-jsonl",children:'{"id": "batch_req_1", "custom_id": "request-1", "response": null, "error": {"code": "batch_expired", "message": "This request could not be executed before the completion window expired."}}\n{"id": "batch_req_1", "custom_id": "request-2", "response": null, "error": {"code": "batch_expired", "message": "This request could not be executed before the completion window expired."}}\n'})})]})}function u(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,o,a)=>{a.d(o,{R:()=>t,x:()=>r});var n=a(6540);const s={},i=n.createContext(s);function t(e){const o=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),n.createElement(i.Provider,{value:o},e.children)}}}]);